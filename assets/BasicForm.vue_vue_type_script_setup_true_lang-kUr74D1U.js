var Re=Object.defineProperty;var Fe=Object.getOwnPropertySymbols;var Ne=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var we=(n,r,s)=>r in n?Re(n,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[r]=s,_=(n,r)=>{for(var s in r||(r={}))Ne.call(r,s)&&we(n,s,r[s]);if(Fe)for(var s of Fe(r))Ce.call(r,s)&&we(n,s,r[s]);return n};var x=(n,r,s)=>new Promise((o,h)=>{var p=c=>{try{g(s.next(c))}catch(u){h(u)}},f=c=>{try{g(s.throw(c))}catch(u){h(u)}},g=c=>c.done?o(c.value):Promise.resolve(c.value).then(p,f);g((s=s.apply(n,r)).next())});import{u as t,g as ke,c as q,w as Z,an as Ke,y as ve,J as Ie,h as Ue,d as He,K as We,r as Ve,f as z,o as Ye,Z as de,a8 as Te,a9 as re,k as Be,ae as ce,_ as Xe,aa as pe,ad as Ee,aj as he,ak as me,F as qe,ac as De,al as Ge}from"./vue-COhTiP8A.js";import{_ as Je}from"./FormItem.vue_vue_type_script_lang-D5sSoIqW.js";import{b as ze,c as Ze,_ as Me}from"./BasicForm.vue_vue_type_style_index_0_lang-BkrzYP5o.js";import{h as Qe,i as le,d as Le,a as et}from"./helper-C_LYGFIk.js";import{H,I as M,J as W,G as tt,u as _e,K as Oe,L as ye,d as Pe,f as nt}from"./entry/index-CVxmJzUk-1713257085139.js";import{e as ue,l as fe,s as G,ae as Ae,ah as je,d as Q,v as xe,f as J,aa as st,ai as at,aj as ot,U as it,a2 as rt}from"./antd-5AEjVWAR.js";import{u as ct}from"./index-dGbg62e7.js";function lt(n,r,s){const o=/^\[(.+)\]$/;if(o.test(n)){const h=n.match(o);if(h&&h[1]){const p=h[1].split(",");return r=Array.isArray(r)?r:[r],p.forEach((f,g)=>{G(s,f.trim(),r[g])}),!0}}}function ft(n,r,s){const o=/^\{(.+)\}$/;if(o.test(n)){const h=n.match(o);if(h&&h[1]){const p=h[1].split(",");return r=H(r)?r:{},p.forEach(f=>{G(s,f.trim(),r[f.trim()])}),!0}}}function ut({defaultValueRef:n,getSchema:r,formModel:s,getProps:o}){function h(c){var w,E;if(!H(c))return{};const u={};for(const O of Object.entries(c)){let[,d]=O;const[I]=O;if(!I||M(d)&&d.length===0||ue(d))continue;const m=t(o).transformDateFunc;H(d)&&(d=m==null?void 0:m(d)),M(d)&&((w=d[0])!=null&&w.format)&&((E=d[1])!=null&&E.format)&&(d=d.map(A=>m==null?void 0:m(A))),fe(d)&&(d=d.trim()),!lt(I,d,u)&&!ft(I,d,u)&&G(u,I,d)}return p(u)}function p(c){const u=t(o).fieldMapToTime;if(!u||!Array.isArray(u))return c;for(const[w,[E,O],d="YYYY-MM-DD"]of u){if(!w||!E||!O)continue;if(!Ae(c,w)){je(c,w);continue}const[I,m]=Ae(c,w),[A,b]=Array.isArray(d)?d:[d,d];!Q(I)&&!xe(I)&&G(c,E,f(I,A)),!Q(m)&&!xe(m)&&G(c,O,f(m,b)),je(c,w)}return c}function f(c,u){return u==="timestamp"?W(c).unix():u==="timestampStartDay"?W(c).startOf("day").unix():W(c).format(u)}function g(){const c=t(r),u={};c.forEach(w=>{const{defaultValue:E,defaultValueObj:O}=w,d=Object.keys(O||{});d.length&&d.forEach(I=>{u[I]=O[I],s[I]===void 0&&(s[I]=O[I])}),Q(E)||(u[w.field]=E,s[w.field]===void 0&&(s[w.field]=E))}),n.value=J(u)}return{handleFormValues:h,initDefault:g}}const X=24;function dt({advanceState:n,emit:r,getProps:s,getSchema:o,formModel:h,defaultValueRef:p}){const f=ke(),{realWidthRef:g,screenEnum:c,screenRef:u}=tt(),w=q(()=>{if(!n.isAdvanced)return 0;const A=t(s).emptySpan||0;if(st(A))return A;if(H(A)){const{span:b=0}=A,k=t(u);return A[k.toLowerCase()]||b||0}return 0}),E=_e(I,30);Z([()=>t(o),()=>n.isAdvanced,()=>t(g)],()=>{const{showAdvancedButton:A}=t(s);A&&E()},{immediate:!0});function O(A,b=0,k=!1){const D=t(g),S=parseInt(A.md)||parseInt(A.xs)||parseInt(A.sm)||A.span||X,P=parseInt(A.lg)||S,R=parseInt(A.xl)||P,N=parseInt(A.xxl)||R;return D<=c.LG?b+=S:D<c.XL?b+=P:D<c.XXL?b+=R:b+=N,k?(n.hideAdvanceBtn=!1,b<=X*2?(n.hideAdvanceBtn=!0,n.isAdvanced=!0):b>X*2&&b<=X*(t(s).autoAdvancedLine||3)?n.hideAdvanceBtn=!1:n.isLoad||(n.isLoad=!0,n.isAdvanced=!n.isAdvanced),{isAdvanced:n.isAdvanced,itemColSum:b}):b>X*(t(s).alwaysShowLines||1)?{isAdvanced:n.isAdvanced,itemColSum:b}:{isAdvanced:!0,itemColSum:b}}const d=Ke({});function I(){var D;let A=0,b=0;const{baseColProps:k={}}=t(s);for(const S of t(o)){const{show:P,colProps:R}=S;let N=!0;if(at(P)&&(N=P),ue(P)&&(N=P({schema:S,model:h,field:S.field,values:_(_({},t(p)),h)})),N&&(R||k)){const{itemColSum:K,isAdvanced:Y}=O(_(_({},k),R),A);A=K||0,Y&&(b=A),d[S.field]=Y}}(D=f==null?void 0:f.proxy)==null||D.$forceUpdate(),n.actionSpan=b%X+t(w),O(t(s).actionColOptions||{span:X},A,!0),r("advanced-change")}function m(){n.isAdvanced=!n.isAdvanced}return{handleToggleAdvanced:m,fieldsIsAdvancedMap:d}}function pt(n,r={}){const s=/^\[(.+)\]$/;if(s.test(n)){const o=n.match(s);if(o&&o[1]){const h=o[1].split(",");if(!h.length)return;const p=[];return h.forEach((f,g)=>{G(p,g,r[f.trim()])}),p.filter(Boolean).length?p:void 0}}}function ht(n,r={}){const s=/^\{(.+)\}$/;if(s.test(n)){const o=n.match(s);if(o&&o[1]){const h=o[1].split(",");if(!h.length)return;const p={};return h.forEach(f=>{G(p,f.trim(),r[f.trim()])}),Object.values(p).filter(Boolean).length?p:void 0}}}function mt({emit:n,getProps:r,formModel:s,getSchema:o,defaultValueRef:h,formElRef:p,schemaRef:f,handleFormValues:g}){function c(){return x(this,null,function*(){const{resetFunc:e,submitOnReset:a}=t(r);e&&ue(e)&&(yield e()),t(p)&&(Object.keys(s).forEach(i=>{const F=t(o).find(T=>T.field===i),y=F==null?void 0:F.defaultValueObj,j=Object.keys(y||{});j.length&&j.forEach(T=>{s[T]=y[T]}),s[i]=yt(F,h,i)}),ve(()=>R()),n("reset",Ie(s)),a&&K())})}const u=()=>t(o).map(e=>[...e.fields||[],e.field]).flat(1).filter(Boolean);function w(e){return x(this,null,function*(){if(Object.keys(e).length===0)return;const a=u(),v=".",i=a.filter(y=>String(y).indexOf(v)>=0),F=[];a.forEach(y=>{const j=t(o).find(V=>V.field===y);let T=Ae(e,y);const ee=Reflect.has(e,y);T=Qe(j==null?void 0:j.component,T);const{componentProps:te}=j||{};let $=te;typeof te=="function"&&($=$({formModel:t(s),formActionType:Y}));const ne=pt(y,e)||ht(y,e),se=V=>V?$!=null&&$.valueFormat?V:W(V):null;if(ee||ne){const V=ne||T;if(k(y))if(Array.isArray(V)){const U=[];for(const l of V)U.push(se(l));t(s)[y]=U}else t(s)[y]=se(V);else t(s)[y]=V;$!=null&&$.onChange&&($==null||$.onChange(V)),F.push(y)}else i.forEach(V=>{try{const U=V.split(".").reduce((l,L)=>l[L],e);Oe(U)&&(t(s)[V]=t(U),F.push(V))}catch(U){Oe(h.value[V])&&(t(s)[V]=J(t(h.value[V])))}})}),D(F).catch(y=>{})})}function E(e){return x(this,null,function*(){const a=J(t(o));if(!e)return;let v=fe(e)?[e]:e;fe(e)&&(v=[e]);for(const i of v)O(i,a);f.value=a})}function O(e,a){if(fe(e)){const v=a.findIndex(i=>i.field===e);v!==-1&&(delete s[e],a.splice(v,1))}}function d(e,a,v=!1){return x(this,null,function*(){const i=J(t(o)),F=Array.isArray(e)?e.map(T=>T.field):[e.field];if(i.find(T=>F.includes(T.field))){ye("There are schemas that have already been added");return}const y=i.findIndex(T=>T.field===a),j=H(e)?[e]:e;!a||y===-1||v?v?i.unshift(...j):i.push(...j):y!==-1&&i.splice(y+1,0,...j),f.value=i,A(e)})}function I(e){return x(this,null,function*(){let a=[];if(H(e)&&a.push(e),M(e)&&(a=[...e]),!a.every(i=>le(i.component)||Reflect.has(i,"field")&&i.field)){ye("All children of the form Schema array that need to be updated must contain the `field` field");return}f.value=a})}function m(e){return x(this,null,function*(){let a=[];if(H(e)&&a.push(e),M(e)&&(a=[...e]),!a.every(y=>le(y.component)||Reflect.has(y,"field")&&y.field)){ye("All children of the form Schema array that need to be updated must contain the `field` field");return}const i=[],F=[];t(o).forEach(y=>{const j=a.find(T=>y.field===T.field);if(j){const T=Pe(y,j);F.push(T),i.push(T)}else i.push(y)}),A(F),f.value=ot(i,"field")})}function A(e){let a=[];H(e)&&a.push(e),M(e)&&(a=[...e]);const v={},i=b();a.forEach(F=>{!le(F.component)&&Reflect.has(F,"field")&&F.field&&!Q(F.defaultValue)&&(!(F.field in i)||Q(i[F.field]))&&(v[F.field]=F.defaultValue)}),w(v)}function b(){return t(p)?g(Ie(t(s))):{}}function k(e){return t(o).some(a=>a.field===e&&a.component?Le.includes(a.component):!1)}function D(e){return x(this,null,function*(){var v;const a=yield(v=t(p))==null?void 0:v.validateFields(e);return g(a)})}function S(e){return x(this,null,function*(){var a;yield(a=t(p))==null?void 0:a.setProps(e)})}function P(e){return x(this,null,function*(){var i;let a;e===void 0?a=u():a=e===Array.isArray(e)?e:void 0;const v=yield(i=t(p))==null?void 0:i.validate(a);return g(v)})}function R(e){return x(this,null,function*(){var a;yield(a=t(p))==null?void 0:a.clearValidate(e)})}function N(e,a){return x(this,null,function*(){var v;yield(v=t(p))==null?void 0:v.scrollToField(e,a)})}function K(e){return x(this,null,function*(){e&&e.preventDefault();const{submitFunc:a}=t(r);if(a&&ue(a)){yield a();return}if(t(p))try{const i=yield P();n("submit",i)}catch(i){if((i==null?void 0:i.outOfDate)===!1&&(i!=null&&i.errorFields))return;throw new Error(i)}})}const Y={getFieldsValue:b,setFieldsValue:w,resetFields:c,updateSchema:m,resetSchema:I,setProps:S,removeSchemaByField:E,appendSchemaByField:d,clearValidate:R,validateFields:D,validate:P,submit:K,scrollToField:N};return{handleSubmit:K,clearValidate:R,validate:P,validateFields:D,getFieldsValue:b,updateSchema:m,resetSchema:I,appendSchemaByField:d,removeSchemaByField:E,resetFields:c,setFieldsValue:w,scrollToField:N}}function yt(n,r,s){let o=J(r.value[s]);return vt(n)?o||void 0:(!o&&n&&At(n)&&(o=[0,0]),!o&&n&&n.component==="ApiTree"&&(o=[]),o)}function At(n){if(n.component==="Slider"&&n.componentProps&&"range"in n.componentProps)return!0}function vt(n){return(n==null?void 0:n.component)&&et.includes(n.component)}function gt(h){return x(this,arguments,function*({getSchema:n,getProps:r,formElRef:s,isInitedDefault:o}){Ue(()=>x(this,null,function*(){if(t(o)||!t(r).autoFocusFirstItem)return;yield ve();const p=t(n),f=t(s),g=f==null?void 0:f.$el;if(!f||!g||!p||p.length===0)return;const c=p[0];if(!c.component||!c.component.includes("Input"))return;const u=g.querySelector(".ant-row:first-child input");u&&(u==null||u.focus())}))})}const Dt=He({name:"BasicForm",__name:"BasicForm",props:ze,emits:["advanced-change","reset","submit","register","field-value-change"],setup(n,{expose:r,emit:s}){const o=n,h=s,p=We(),f=Ve({}),g=ct(),c=Ve({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),u=z({}),w=z(!1),E=z(),O=z(null),d=z(null),{prefixCls:I}=nt("basic-form"),m=q(()=>_(_({},o),t(E))),A=q(()=>[I,{[`${I}--compact`]:t(m).compact}]),b=q(()=>{const{baseRowStyle:l={},rowProps:L}=t(m);return _({style:l},L)}),k=q(()=>_(_(_({},p),o),t(m))),D=q(()=>{var L;const l=J(t(O)||t(m).schemas);for(const B of l){const{defaultValue:C,component:ae,componentProps:oe={},isHandleDateDefaultValue:$e=!0}=B;if($e&&C&&ae&&Le.includes(ae)){const Se={schema:B,tableAction:(L=o.tableAction)!=null?L:{},formModel:f,formActionType:{}},ie=oe?typeof oe=="function"?oe(Se).valueFormat:oe.valueFormat:null;if(!Array.isArray(C))B.defaultValue=ie?W(C).format(ie):W(C);else{const ge=[];C.forEach(be=>{ge.push(ie?W(be).format(ie):W(be))}),B.defaultValue=ge}}}return t(m).showAdvancedButton?l.filter(B=>!le(B.component)):l}),{handleToggleAdvanced:S,fieldsIsAdvancedMap:P}=dt({advanceState:c,emit:h,getProps:m,getSchema:D,formModel:f,defaultValueRef:u}),{handleFormValues:R,initDefault:N}=ut({getProps:m,defaultValueRef:u,getSchema:D,formModel:f});gt({getSchema:D,getProps:m,isInitedDefault:w,formElRef:d});const{handleSubmit:K,setFieldsValue:Y,clearValidate:e,validate:a,validateFields:v,getFieldsValue:i,updateSchema:F,resetSchema:y,appendSchemaByField:j,removeSchemaByField:T,resetFields:ee,scrollToField:te}=mt({emit:h,getProps:m,formModel:f,getSchema:D,defaultValueRef:u,formElRef:d,schemaRef:O,handleFormValues:R});Ze({resetAction:ee,submitAction:K}),Z(()=>t(m).model,()=>{const{model:l}=t(m);l&&Y(l)},{immediate:!0}),Z(()=>o.schemas,l=>{y(l!=null?l:[])}),Z(()=>D.value,l=>{ve(()=>{var L;(L=g==null?void 0:g.redoModalHeight)==null||L.call(g)}),!t(w)&&l!=null&&l.length&&(N(),w.value=!0)}),Z(()=>f,_e(()=>{t(m).submitOnChange&&K()},300),{deep:!0});function $(l){return x(this,null,function*(){E.value=Pe(t(E)||{},l)})}function ne(l,L,B){f[l]=L,h("field-value-change",l,L),B&&B.itemProps&&!B.itemProps.autoLink&&v([l]).catch(C=>{})}function se(l){const{autoSubmitOnEnter:L}=t(m);if(L&&l.key==="Enter"&&l.target&&l.target instanceof HTMLElement){const B=l.target;B&&B.tagName&&B.tagName.toUpperCase()==="INPUT"&&K()}}const V={getFieldsValue:i,setFieldsValue:Y,resetFields:ee,updateSchema:F,resetSchema:y,setProps:$,removeSchemaByField:T,appendSchemaByField:j,clearValidate:e,validateFields:v,validate:a,submit:K,scrollToField:te},U=q(()=>_(_({},m.value),c));return r(_({},V)),Ye(()=>{N(),h("register",V)}),(l,L)=>(de(),Te(t(rt),De(k.value,{class:A.value,ref_key:"formElRef",ref:d,model:f,onKeypress:Ge(se,["enter"])}),{default:re(()=>[Be(t(it),he(me(b.value)),{default:re(()=>[ce(l.$slots,"formHeader"),(de(!0),Xe(qe,null,pe(D.value,B=>(de(),Te(Je,{key:B.field,isAdvanced:t(P)[B.field],tableAction:l.tableAction,formActionType:V,schema:B,formProps:m.value,allDefaultValues:u.value,formModel:f,setFormModel:ne},Ee({_:2},[pe(Object.keys(l.$slots),C=>({name:C,fn:re(ae=>[ce(l.$slots,C,he(me(ae||{})))])}))]),1032,["isAdvanced","tableAction","schema","formProps","allDefaultValues","formModel"]))),128)),Be(Me,De(U.value,{onToggleAdvanced:t(S)}),Ee({_:2},[pe(["resetBefore","submitBefore","advanceBefore","advanceAfter"],B=>({name:B,fn:re(C=>[ce(l.$slots,B,he(me(C||{})))])}))]),1040,["onToggleAdvanced"]),ce(l.$slots,"formFooter")]),_:3},16)]),_:3},16,["class","model"]))}});export{Dt as _};
